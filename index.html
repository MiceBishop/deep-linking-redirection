<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Redirecting...</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        text-align: center;
      }
      .error {
        color: #dc3545;
      }
      .info {
        color: #0066cc;
      }
    </style>
    <script>
      function tryDeepLink() {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const app = urlParams.get("app");

        if (!app) {
          showError("Missing 'app' parameter in the URL.");
          return;
        }

        // Construct the path from all remaining parameters
        const path = Array.from(urlParams.entries())
          .filter(([key]) => key !== "app")
          .map(([, value]) => value)
          .join("/");

        const deepLinkURL = `${app}://${path}`;
        const fallbackURL = urlParams.get("fallback") || null;

        // Create hidden iframe for deep link attempt
        const iframe = document.createElement("iframe");
        iframe.style.display = "none";
        document.body.appendChild(iframe);

        // Set timeout for fallback
        const timeout = setTimeout(() => {
          if (fallbackURL) {
            window.location.href = fallbackURL;
          } else {
            showError(
              `Unable to open ${app}. Please make sure the app is installed.`
            );
          }
        }, 5000);

        // Try deep link
        iframe.src = deepLinkURL;

        // Cleanup
        setTimeout(() => {
          document.body.removeChild(iframe);
        }, 2100);
      }

      function showError(message) {
        document.getElementById(
          "message"
        ).innerHTML = `<p class="error">${message}</p>`;
      }

      // Run when page loads
      window.onload = tryDeepLink;
    </script>
  </head>
  <body>
    <div id="message">
      <p class="info">Redirecting...</p>
    </div>
  </body>
</html>
